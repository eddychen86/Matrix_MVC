@inject ICustomLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Config_Title"];
}

<div id="adminConfig" class="w-full h-full">
    <template v-if="isLoading">
        <div class="flex h-[50vh] w-full items-center justify-center">
            <div class="flex flex-col items-center gap-4">
                <img src="~/static/img/Loading.gif" alt="Loading" class="h-16 w-16" />
                <span class="text-gray-700">Loading</span>
            </div>
        </div>
    </template>
    <template v-else>
        <div class="flex flex-col gap-8">
            <h1 class="text-3xl font-bold text-gray-700 col-span-1 sm:col-span-4" data-i18n="Config_Title">@Localizer["Config_Title"]</h1>

            @* 管理員列表 *@
            <div class="grid grid-cols-1 sm:grid-cols-4 gap-8">
                <div class="tabs tabs-lift col-span-1">
                    @* 篩選列表 *@
                    <input type="radio" name="config_tabs" class="tab subTitle w-1/2" data-i18n="Config_Filter" aria-label="@Localizer["Config_Filter"]" checked="checked" />
                    <div class="tab-content border-black/10 p-6">
                        <ul class="flex flex-col gap-4">
                            <li v-for="tool in adminFilter" :key="tool.id">
                                <!-- 文字搜尋 -->
                                <template v-if="tool.type === 'text'">
                                    <div class="flex flex-col gap-2">
                                        <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                        <label class="input validator rounded-full">
                                            <i data-lucide="search" class="size-4 opacity-50"></i>
                                            <input type="search" 
                                                   v-model="adminFilterVal[tool.title]" 
                                                   :data-i18n-placeholder="tool.placeholderKey || ''"
                                                   :placeholder="@Localizer["tool.placeholderKey"]" />
                                        </label>
                                    </div>
                                </template>

                                <!-- 開關選項 -->
                                <template v-else-if="tool.type === 'switch'">
                                    <div class="flex flex-col 2xl:flex-row sm:items-start 2xl:items-center justify-between sm:justify-normal gap-2">
                                        <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                        <div class="tabs tabs-box border border-base-300 rounded-md">
                                            <input type="radio" 
                                                   class="tab" 
                                                   v-for="opt in switchOpts" 
                                                   :key="opt.id" 
                                                   v-model="adminFilterVal[tool.title]" 
                                                   :value="opt.id" 
                                                   :aria-label="opt.title" />
                                        </div>
                                    </div>
                                </template>
                            </li>

                            <!-- 篩選控制按鈕 -->
                            <li class="flex gap-2 justify-center">
                                <button class="btn bg-secondary text-white btn-sm" @@click="applyFilter">
                                    <i data-lucide="filter" class="size-4"></i>
                                    <span data-i18n="Apply">套用</span>
                                </button>
                                <button class="btn btn-ghost btn-sm border border-base-300" @@click="clearFilter">
                                    <i data-lucide="x" class="size-4"></i>
                                    <span data-i18n="Clear">清除</span>
                                </button>
                            </li>
                        </ul>
                    </div>

                    @* 新增「管理員」 *@
                    <input type="radio" name="config_tabs" class="tab subTitle w-1/2" data-i18n="Config_Add_Admin" aria-label="@Localizer["Config_Add_Admin"]" />
                    <div class="tab-content border-black/10 p-6">
                        <form v-on:submit.prevent="submitCreateAdmin" class="space-y-4">
                            @* 頭像上傳 *@
                            <div class="input-item">
                                <label class="subTitle" data-i18n="Avatar">@Localizer["Avatar"]</label>
                                <div class="flex items-center text-center gap-4 mt-2">
                                    <div class="avatar cursor-pointer mask mask-squircle h-16 w-16" @@click="triggerFileUpload">
                                        <img v-if="formData.avatarPreview" :src="formData.avatarPreview" alt="Avatar Preview" />
                                        <div v-else class="flex items-end justify-center pt-4 px-2 bg-gray-300">
                                            <i data-lucide="user-round" class="size-12"></i>
                                        </div>
                                    </div>
                                    <input type="file" ref="fileInput" class="hidden" accept="image/*" @@change="handleAvatarUpload" />
                                </div>
                            </div>

                            @* 使用者名稱 *@
                            <div class="input-item">
                                <label for="userName" class="subTitle" data-i18n="UserName">@Localizer["UserName"]</label>
                                <label class="input validator rounded-full mt-2 w-full">
                                    <i data-lucide="user" class="size-4 opacity-50"></i>
                                    <input type="text" v-model="formData.userName"
                                           placeholder="@Localizer["UserNamePlaceholder"]" data-i18n-placeholder="UserNamePlaceholder" />
                                </label>
                                <p v-show="formErrors.userName" class="text-red-400 para">{{ formErrors.userName }}</p>
                            </div>

                            @* Email *@
                            <div class="input-item">
                                <label for="email" class="subTitle" data-i18n="Email">@Localizer["Email"]</label>
                                <label class="input validator rounded-full mt-2 w-full">
                                    <i data-lucide="mail" class="size-4 opacity-50"></i>
                                    <input type="email" v-model="formData.email"
                                           placeholder="@Localizer["EmailPlaceholder"]" data-i18n-placeholder="EmailPlaceholder" />
                                </label>
                                <p v-show="formErrors.email" class="text-red-400 para">{{ formErrors.email }}</p>
                            </div>

                            @* 密碼 *@
                            <div class="input-item">
                                <label for="password" class="subTitle" data-i18n="Password">@Localizer["Password"]</label>
                                <label class="input validator rounded-full mt-2 w-full">
                                    <i data-lucide="key" class="size-4 opacity-50"></i>
                                    <input type="password" v-model="formData.password"
                                           placeholder="@Localizer["PasswordPlaceholder"]" data-i18n-placeholder="PasswordPlaceholder" />
                                </label>
                                <p v-show="formErrors.password" class="text-red-400 para">{{ formErrors.password }}</p>
                            </div>

                            @* 確認密碼 *@
                            <div class="input-item">
                                <label for="passwordConfirm" class="subTitle" data-i18n="ConfirmPassword">@Localizer["ConfirmPassword"]</label>
                                <label class="input validator rounded-full mt-2 w-full">
                                    <i data-lucide="key" class="size-4 opacity-50"></i>
                                    <input type="password" v-model="formData.passwordConfirm"
                                           placeholder="@Localizer["ConfirmPasswordPlaceholder"]" data-i18n-placeholder="ConfirmPasswordPlaceholder" />
                                </label>
                                <p v-show="formErrors.passwordConfirm" class="text-red-400 para">{{ formErrors.passwordConfirm }}</p>
                            </div>

                            @* 角色選擇（僅超級管理員可見） *@
                            <div v-if="userPermissions.role === 2" class="input-item">
                                <label for="role" class="subTitle" data-i18n="Users_RoleText">@Localizer["Users_RoleText"]</label>
                                <select v-model="formData.role" class="select select-primary rounded-full w-full mt-2">
                                    <option value="1" data-i18n="Config_AdminList_Admin">@Localizer["Config_AdminList_Admin"]</option>
                                    <option value="2" data-i18n="Config_AdminList_SuperAdmin">@Localizer["Config_AdminList_SuperAdmin"]</option>
                                </select>
                            </div>

                            @* 提交按鈕 *@
                            <div class="flex items-center justify-center gap-4 pt-4">
                                <button type="button"
                                        @@click="cancelCreateAdmin"
                                        class="btn btn-ghost">
                                    <span data-i18n="Cancel">Cancel</span>
                                </button>
                                <button type="submit"
                                        :disabled="isSubmitting"
                                        class="btn btn-primary">
                                    <span v-if="isSubmitting" class="loading loading-spinner loading-sm"></span>
                                    <span data-i18n="Create">Create</span>
                                </button>
                            </div>
                        </form>                       
                    </div>
                </div>

                <div class="col-span-1 sm:col-span-3">
                    <div class="overflow-x-auto bg-yellow-50 rounded-2xl border border-black/10 min-h-[500px]">
                        <table class="table table-pin-rows table-pin-cols">
                            <!-- head -->
                            <thead>
                                <tr class="text-center bg-yellow-50">
                                    <td v-for="head in adminList.header" :key="head.title" :class="head.class" :data-i18n="head.title"></td>
                                    <th class="bg-yellow-50"></th>
                                </tr>
                            </thead>

                            <tbody class="subTitle">
                                <tr v-for="item in adminList.data" :key="item.id" class="hover:bg-yellow-100">
                                    <td>
                                        <div class="flex items-center gap-3">
                                            <div class="avatar">
                                                <div class="mask mask-squircle h-12 w-12" :class="!item.Avatar ? 'flex items-end justify-center pt-3 px-1 bg-gray-300' : ''">
                                                    <img v-if="item.Avatar" :src="item.Avatar" :alt="item.UserName" :title="item.UserName" />
                                                    <i v-else data-lucide="user-round" class="size-10"></i>
                                                </div>
                                            </div>
                                            <div class="flex flex-col gap-1">
                                                <div class="font-bold">{{ item.UserName }}</div>
                                                <div class="text-sm opacity-50">{{ item.email }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ item.DisplayName }}</td>
                                    <td class="text-center">
                                        <template v-if="item.isEditing && item.SuperAdmin === 2">
                                            <label class="toggle text-base-content toggle-xl toggle-error checked:toggle-success">
                                                <input type="checkbox" v-model="item.isSuperAdmin" />
                                                <svg aria-label="disabled" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M18 6 6 18" />
                                                    <path d="m6 6 12 12" />
                                                </svg>
                                                <svg aria-label="enabled" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                    <g stroke-linejoin="round" stroke-linecap="round" stroke-width="4" fill="none" stroke="currentColor">
                                                        <path d="M20 6 9 17l-5-5"></path>
                                                    </g>
                                                </svg>
                                            </label>
                                        </template>
                                        <template v-else>
                                            <div :data-i18n="item.SuperAdmin === 2 ? 'Yes' : 'No'"></div>
                                        </template>
                                    </td>
                                    <td>
                                        <div class="flex justify-center items-center">
                                            <template v-if="item.isEditing">
                                                <label class="toggle text-base-content toggle-xl toggle-error checked:toggle-success">
                                                    <input type="checkbox" v-model="item.isActive" />
                                                    <svg aria-label="disabled" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M18 6 6 18" />
                                                        <path d="m6 6 12 12" />
                                                    </svg>
                                                    <svg aria-label="enabled" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                        <g stroke-linejoin="round" stroke-linecap="round" stroke-width="4" fill="none" stroke="currentColor">
                                                            <path d="M20 6 9 17l-5-5"></path>
                                                        </g>
                                                    </svg>
                                                </label>
                                            </template>
                                            <template v-else>
                                                <div class="rounded-full text-center text-white w-20 shadow-xl/30 border-2"
                                                        :class="item.status === 1 ? 'bg-green-500 border-green-300 shadow-green-300' : 'bg-red-500 border-red-300 shadow-red-300'"
                                                        :data-i18n="item.status === 1 ? 'enable' : 'disable'"
                                                        ></div>
                                            </template>
                                        </div>
                                    </td>
                                    <th class="text-center bg-yellow-50">
                                        <div class="join">
                                            <template v-if="item.isEditing">
                                                <button class="btn btn-ghost rounded-md btn-sm px-2 py-1" @@click="saveAdmin(item.id)">
                                                    <i data-lucide="save" class="size-6 text-blue-500 cursor-pointer"></i>
                                                </button>
                                                <button class="btn btn-ghost rounded-md btn-sm px-2 py-1" @@click="cancelEdit(item.id)">
                                                    <i data-lucide="ban" class="size-6 text-red-500 cursor-pointer"></i>
                                                </button>
                                            </template>
                                            <template v-else>
                                                <button class="btn btn-ghost rounded-md btn-sm px-2 py-1" @@click="editAdmin(item.id)">
                                                    <i data-lucide="pen" class="size-6 text-blue-500 cursor-pointer"></i>
                                                </button>
                                                <button class="btn btn-ghost rounded-md btn-sm px-2 py-1" @@click="delAdmin(item.id)">
                                                    <i data-lucide="trash-2" class="size-6 text-red-500 cursor-pointer"></i>
                                                </button>
                                            </template>
                                        </div>
                                    </th>
                                </tr>
                            </tbody>

                            <!-- foot -->
                            <tfoot v-if="adminList_totalPages > 1">
                                <tr>
                                    <td colspan="6" class="bg-yellow-50">
                                        <div class="flex items-center justify-center w-full py-2">
                                            <div class="join">
                                                <!-- 上一頁 -->
                                                <button class="join-item bg-white btn" 
                                                        :disabled="adminList_curPage === 1"
                                                        @@click="togglePrevPage">
                                                    <i data-lucide="chevron-left" class="size-8 text-black"></i>
                                                </button>
                                                
                                                <!-- 第一頁 -->
                                                <button class="join-item btn"
                                                        :class="adminList_curPage === 1 ? 'bg-blue-500 text-white' : 'bg-white'"
                                                        @@click="toggleFirstPage">1</button>

                                                <!-- 省略號 -->
                                                <button class="join-item bg-white btn btn-disabled"
                                                        v-if="adminList_curPage >= 4">...</button>
                                                
                                                <!-- 當前頁（如果不是第一頁也不是最後一頁） -->
                                                <button class="join-item bg-blue-500 text-white btn"
                                                        v-if="adminList_curPage > 1 && adminList_curPage < adminList_totalPages">{{ adminList_curPage }}</button>
                                                
                                                <!-- 省略號 -->
                                                <button class="join-item bg-white btn btn-disabled"
                                                        v-if="adminList_curPage <= adminList_totalPages - 3">...</button>

                                                <!-- 最後一頁 -->
                                                <button class="join-item btn"
                                                        v-if="adminList_totalPages > 1"
                                                        :class="adminList_curPage === adminList_totalPages ? 'bg-blue-500 text-white' : 'bg-white'"
                                                        @@click="toggleLastPage">{{ adminList_totalPages }}</button>
                                                
                                                <!-- 下一頁 -->
                                                <button class="join-item bg-white btn" 
                                                        :disabled="adminList_curPage === adminList_totalPages"
                                                        @@click="toggleNextPage">
                                                    <i data-lucide="chevron-right" class="size-8 text-black"></i>
                                                </button>
                                            </div>
                                            
                                            <!-- 分頁資訊 -->
                                            <div class="ml-4 text-sm text-gray-600">
                                                第 {{ adminList_curPage }} 頁，共 {{ adminList_totalPages }} 頁 ({{ adminList_totalCount }} 筆記錄)
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            @* 日誌 *@
            @* <div class="grid grid-cols-1 sm:grid-cols-4 gap-8">
                <div class="flex flex-col gap-4 col-span-1">
                    <h3 class="subTitle font-semibold" data-i18n="Config_LoginList">@Localizer["Config_LoginList"]</h3>
                    <ul class="flex flex-col gap-4">
                        <li v-for="tool in logFilter" :key="tool.id">
                            <!-- 文字搜尋 -->
                            <template v-if="tool.type === 'text'">
                                <div class="flex flex-col gap-2">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <label class="input validator rounded-full">
                                        <i data-lucide="search" class="size-4 opacity-50"></i>
                                        <input type="search" 
                                               v-model="logFilterVal[tool.title]" 
                                               :data-i18n-placeholder="tool.placeholderKey || ''"
                                               :placeholder="@Localizer["tool.placeholderKey"]" />
                                    </label>
                                </div>
                            </template>

                            <!-- 數字輸入 -->
                            <template v-else-if="tool.type === 'Number'">
                                <div class="flex flex-col gap-2">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <label class="input validator rounded-full">
                                        <i data-lucide="hash" class="size-4 opacity-50"></i>
                                        <input type="number" 
                                               v-model="logFilterVal[tool.title]" 
                                               :data-i18n-placeholder="tool.placeholderKey || ''"
                                               :placeholder="@Localizer["tool.placeholderKey"]" />
                                    </label>
                                </div>
                            </template>

                            <!-- 日期時間 -->
                            <template v-else-if="tool.type === 'DateTime'">
                                <div class="flex flex-col gap-2">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <label class="input validator rounded-full">
                                        <i data-lucide="calendar" class="size-4 opacity-50"></i>
                                        <input type="datetime-local"
                                               v-model="logFilterVal[tool.title]" />
                                    </label>
                                </div>
                            </template>

                            <!-- 下拉選單 -->
                            <template v-else-if="tool.type === 'select'">
                                <div class="flex flex-col gap-2">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <select class="select select-primary rounded-full" 
                                            v-model="logFilterVal[tool.title]">
                                        <option value="">請選擇...</option>
                                        <option v-for="opt in tool.options || []" 
                                                :key="opt.value || opt.id" 
                                                :value="opt.value || opt.id"
                                                :data-i18n="opt.title">{{ opt.title }}</option>
                                    </select>
                                </div>
                            </template>

                            <!-- 開關 -->
                            <template v-else-if="tool.type === 'switch'">
                                <!-- 如果有自訂選項，使用 tab 樣式 -->
                                <div v-if="tool.options" class="flex items-center justify-between">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <div class="tabs tabs-box border border-base-300 rounded-md">
                                        <input type="radio" 
                                               class="tab" 
                                               v-for="opt in tool.options" 
                                               :key="opt.id" 
                                               v-model="logFilterVal[tool.title]" 
                                               :value="opt.value" 
                                               :aria-label="opt.title"
                                               @@change="applyFilter" />
                                    </div>
                                </div>
                                <!-- 傳統的 toggle 開關 -->
                                <div v-else class="flex items-center justify-between">
                                    <h5 class="subTitle" :data-i18n="tool.title">{{ tool.title }}</h5>
                                    <label class="toggle text-base-content">
                                        <input type="checkbox" v-model="logFilterVal[tool.title]" />
                                        <i data-lucide="check" class="size-6"></i>
                                        <i data-lucide="x" class="size-6"></i>
                                    </label>
                                </div>
                            </template>
                        </li>
                    </ul>
                </div>

                <div class="col-span-1 sm:col-span-3">
                    <div class="overflow-x-auto bg-yellow-50 rounded-2xl border border-black/10 min-h-[500px]">
                        <table class="table table-pin-rows table-pin-cols">
                            
                        </table>
                    </div>
                </div>
            </div> *@
        </div>
    </template>
</div>

@section Scripts {
    <script src="~/js/dashboard/pages/config/config.js" asp-append-version="true"></script>
}

@inject ICustomLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Posts_Title"];
}

<div id="adminPosts" class="w-full h-full">
    <template v-if="isLoading">
        <div class="flex h-[50vh] w-full items-center justify-center">
            <div class="flex flex-col items-center gap-4">
                <img src="~/static/img/Loading.gif" alt="Loading" class="h-16 w-16" />
                <span class="text-gray-700">Loading</span>
            </div>
        </div>
    </template>
    <template v-else>
        <div class="flex flex-col 2xl:flex-row 2xl:grid h-full w-full grid-cols-4 gap-4">
            <h2 class="col-span-4 text-5xl font-bold text-gray-700" data-i18n="Posts_Title">@Localizer["Posts_Title"]
            </h2>
            <!-- 左側欄 -->
            <aside class="col-span-1 grid grid-cols-4 2xl:flex flex-row 2xl:flex-col gap-8 border-r border-gray-200 bg-white">
                <div class="flex justify-end gap-4 col-span-1">
                    <div class="relative w-full">
                        <input name="keyword" type="text" v-model="keyword" @@keyup.enter="search"
                            class="w-full rounded border bg-gray-50 px-3 py-2 focus:ring-2 focus:ring-blue-200 focus:outline-none"
                            data-i18n-placeholder="Posts_SearchKeywordPlaceholder"
                            placeholder="@Localizer["Posts_SearchKeywordPlaceholder"]">
                        <button type="button" @@click="() => {page = 1;loadArticles()}"
                            class="absolute top-1/2 right-4 -translate-y-1/2 cursor-pointer">
                            <i data-lucide="search" class="icon-base"></i>
                        </button>
                    </div>
                </div>
                <div class="flex items-center justify-between gap-3 col-span-1">
                    <span class="text-base font-semibold text-[20px] text-gray-700"
                        data-i18n="Posts_Status">@Localizer["Posts_Status"]</span>
                    <div class="flex rounded-full border border-blue-400 bg-white p-0.5 shadow-inner">
                        <!-- All -->
                        <input type="radio" id="status-all" name="statusFilter" class="peer/all hidden"
                            v-model.number="filterStatus" :value="-1" @@change="applyFilters">
                        <label for="status-all"
                            class="cursor-pointer rounded-full px-3 py-1 text-sm font-semibold text-gray-400 transition peer-checked/all:bg-blue-700 peer-checked/all:text-white peer-checked/all:shadow"
                            data-i18n="Posts_All">
                            @Localizer["Posts_All"]
                        </label>

                        <!-- Enable (0) -->
                        <input type="radio" id="status-enable" name="statusFilter" class="peer/enable hidden"
                            v-model.number="filterStatus" :value="0" @@change="applyFilters">
                        <label for="status-enable"
                            class="cursor-pointer rounded-full px-3 py-1 text-sm font-semibold text-gray-400 transition peer-checked/enable:bg-blue-700 peer-checked/enable:text-white peer-checked/enable:shadow"
                            data-i18n="Posts_Enable">
                            @Localizer["Posts_Enable"]
                        </label>

                        <!-- Disable (1) -->
                        <input type="radio" id="status-disable" name="statusFilter" class="peer/disable hidden"
                            v-model.number="filterStatus" :value="1" @@change="applyFilters">
                        <label for="status-disable"
                            class="cursor-pointer rounded-full px-3 py-1 text-sm font-semibold text-gray-400 transition peer-checked/disable:bg-blue-700 peer-checked/disable:text-white peer-checked/disable:shadow"
                            data-i18n="Posts_Disable">
                            @Localizer["Posts_Disable"]
                        </label>
                    </div>
                </div>

                <div class="flex justify-end gap-4 col-span-1">
                    <div class="relative w-full">
                        <input id="calendar" v-model="filterDate" @@keyup.enter="search"
                            class="w-full rounded border bg-gray-50 px-3 py-2 focus:ring-2 focus:ring-blue-200 focus:outline-none"
                            placeholder="@Localizer["Users_SearchDatePlaceholder"]"
                            data-i18n-placeholder="Users_SearchDatePlaceholder">
                        <button @@click="search"
                            class="absolute top-1/2 right-4 -translate-y-1/2 cursor-pointer">
                            <i data-lucide="search" class="icon-base"></i>
                        </button>
                    </div>
                </div>
                <div class="h-40 w-full hidden 2xl:block">
                    <calendar-date class="cally bg-base-100 border-base-300 rounded-box w-full border shadow-lg"
                        @@change="toggleDate($event)">
                        <svg aria-label="Previous" class="size-4 fill-current text-[#161616]" slot="previous"
                            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M15.75 19.5 8.25 12l7.5-7.5"></path>
                        </svg>
                        <svg aria-label="Next" class="size-4 fill-current text-[#161616]" slot="next"
                            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="currentColor" d="m8.25 4.5 7.5 7.5-7.5 7.5"></path>
                        </svg>
                        <calendar-month></calendar-month>
                    </calendar-date>
                </div>
            </aside>
            <!-- 右側主表格 -->
            <main class="col-span-3 h-full">
                <div class="h-full w-full rounded-2xl border border-black/10 bg-yellow-50 p-4">
                    <table class="table w-full">
                        <thead>
                            <tr>
                                <th data-i18n="Posts_Content">@Localizer["Posts_Content"]</th>
                                <th data-i18n="Posts_UserName">@Localizer["Posts_UserName"]</th>
                                <th data-i18n="Posts_Status">@Localizer["Posts_Status"]</th>
                                <th data-i18n="Posts_CreateTime">@Localizer["Posts_CreateTime"]</th>
                                <th data-i18n="Posts_ModifyTime">@Localizer["Posts_ModifyTime"]</th>
                                <th data-i18n="Posts_Edit">@Localizer["Posts_Edit"]</th>
                                <th data-i18n="Posts_Delete">@Localizer["Posts_Delete"]</th>
                            </tr>
                        </thead>

                        <tbody class="text-[14px]">
                            <template v-for="item in articles" :key="item.articleId">
                                <tr class="cursor-pointer hover:bg-blue-100">
                                    <td class="max-w-[200px] truncate">{{ item.content }}</td>
                                    <td>{{ item.authorName }}</td>
                                    <td>
                                        <template v-if="editingId === item.articleId">
                                            <div class="flex items-center gap-2">
                                                <select v-model.number="editingStatus" class="rounded border px-2 py-1">
                                                    <option :value="0" data-i18n="Posts_Status_Normal">
                                                        @Localizer["Posts_Status_Normal"]</option>
                                                    <option :value="1" data-i18n="Posts_Status_Hidden">
                                                        @Localizer["Posts_Status_Hidden"]</option>
                                                </select>
                                                <button @@click.stop="saveStatus(item)" :disabled="savingStatus"
                                                    class="rounded bg-green-600 px-2 py-1 text-white disabled:opacity-50"
                                                    data-i18n="Posts_Save">
                                                    @Localizer["Posts_Save"]
                                                </button>
                                                <button @@click.stop="cancelEdit"
                                                    class="rounded bg-gray-400 px-2 py-1 text-white"
                                                    data-i18n="Posts_Cancel">
                                                    @Localizer["Posts_Cancel"]
                                                </button>
                                            </div>
                                        </template>
                                        <template v-else>
                                            {{ item.statusText || statusText(item.status) }}
                                        </template>
                                    </td>
                                    <td>{{ formatDate(item.createTime) }}</td>
                                    <td>{{ formatDate(item.createTime) }}</td>
                                    <td class="w-12 text-center">
                                        <!-- 編輯 -->
                                        <div v-if="editingId !== item.articleId" class="flex justify-center">
                                            <button @@click.stop="startEdit(item)"
                                                class="rounded bg-blue-500 p-1 text-white hover:bg-blue-700"
                                                title="Edit status">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path
                                                        d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                                                    <path d="m15 5 4 4" />
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                    <td class="w-12 text-center">
                                        <!-- 刪除 -->
                                        <button @@click.stop="deleteArticle(item.articleId)"
                                            class="flex items-center justify-center rounded bg-red-500 p-1 text-white hover:bg-red-700"
                                            title="Delete">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M4.929 4.929 19.07 19.071" />
                                                <circle cx="12" cy="12" r="10" />
                                            </svg>
                                        </button>
                                    </td>
                                </tr>

                            </template>
                        </tbody>

                        <tfoot v-if="totalPages > 0">
                            <tr>
                                <td colspan="9">
                                    <div class="bg-yellow-50 px-4 py-2">
                                        <div class="flex justify-center gap-1">
                                            <!-- 上一頁 -->
                                            <button :disabled="page === 1" @@click="goPage(page - 1)"
                                                class="rounded px-2 py-1 text-gray-500 hover:bg-gray-200">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-chevron-left-icon lucide-chevron-left">
                                                    <path d="m15 18-6-6 6-6" />
                                                </svg>
                                            </button>
                                            <!-- 頁碼 -->
                                            <button v-for="(p, index) in showPage" :key="p" :disabled="p === '...'"
                                                @@click="typeof p === 'number'&&goPage(p)" class="rounded px-2 py-1"
                                                :class="p === page ? 'bg-blue-100 text-blue-700' : 'text-gray-700 hover:bg-gray-200'">
                                                {{ p }}
                                            </button>
                                            <!-- 下一頁 -->
                                            <button :disabled="page === totalPages" @@click="goPage(page + 1)"
                                                class="rounded px-2 py-1 text-gray-500 hover:bg-gray-200">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="lucide lucide-chevron-right-icon lucide-chevron-right">
                                                    <path d="m9 18 6-6-6-6" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>

                    </table>
                </div>
            </main>
        </div>
    </template>
</div>

@section Scripts {
    <script src="~/js/dashboard/pages/posts/posts.js" asp-append-version="true"></script>
}

@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    // Layout = null;
}
@* <script src="https://cdn.tailwindcss.com"></script> *@

@* <!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Layout Example</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

</head> *@
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
@* <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/fontawesome.min.css"></script> *@
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://unpkg.com/lucide-static/font/lucide.css" rel="stylesheet" />
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<div id="app" class="relative mx-auto flex w-full max-w-[1920px] flex-col bg-[#161616] text-white">
    <!-- Profile View -->
    <!-- 頂部橫幅與頭像 -->
    <div class="relative flex h-40 w-full items-center justify-center rounded-lg bg-[#161616]">
        <img :src="profile.bannerPath" alt="Profile Banner" class="h-full w-full object-cover object-right" />
        <div class="absolute top-1/2 left-1/3 flex -translate-x-1/2 translate-y-10 items-center justify-between gap-4">
            <img :src="profile.avatarPath" class="h-36 w-36 rounded-full bg-[#161616] object-cover object-center p-4" />
        </div>
        @* <div class="absolute right-0 bottom-0 h-full w-[300px] bg-[#161616]"></div> *@
    </div>

    <!-- 姓名與按鈕 -->
    <div class="relative mt-8 flex flex-col items-center justify-between px-8 md:flex-row md:pr-[300px]">
        <div class="flex items-center gap-3 md:ml-[550px]">
            <span class="font-sans text-2xl leading-[40px] font-semibold text-white md:text-[40px]">{{profile.displayName}}</span>

            <span :class="['text-xl text-white', isPublic ? 'fa-solid fa-globe' : 'fa-solid fa-user-lock']"></span>

        </div>


        <button class="mt-4 h-10 w-22 rounded-[24px] bg-white text-base font-bold text-black shadow transition hover:bg-gray-200 md:mt-0">
            Create
        </button>
    </div>

    <!-- 主要內容區塊 -->
    <div class="mt-8 flex flex-col gap-6 px-8 lg:flex-row lg:pr-[300px]">
        <!-- 左側：個人資訊 -->

        <div class="mx-auto w-full max-w-[350px] lg:mx-0">
            <div class="mb-4 rounded-xl bg-gray-800 p-10 shadow">
                <div class="flex items-center gap-4">
                    <div class="flex w-full items-center justify-between">
                        <h2 class="font-bold text-[23px] text-white">Profile Overview</h2>
                        <button @@click="startEdit">
                            <i data-lucide="pen" class="icon-base h-5 w-5 cursor-pointer sm:h-6 sm:w-6"></i>
                        </button>
                    </div>
                </div>
                <div class="mt-3">
                    <p class="mb-4 h-[100px] text-[16px] text-gray-300">{{profile.bio}}</p>
                    <div class="space-y-1 text-[17px] text-gray-400">
                        <div class="mt-8">{{profile.email}}</div>
                        <div class="mt-3">{{profile.website1}}</div>
                        <div>{{profile.website2}}</div>
                        <div>{{profile.website3}}</div>
                    </div>
                </div>
                <div class="mt-4 flex flex-col gap-2">
                    <img
                        v-for="(article, idx) in profile.articles.slice(0, 2)"
                        :key="article.articleId"
                        :src="'/api/ProfileApi/GetPicture/' + article.articleId + '?v=' + rand"
                        class="mt-4 h-[108px] w-full rounded-lg object-cover"
                        alt=""
                     />
                </div>
            </div>
        </div>


        <!-- 中間：動態貼文 -->
        <div class="flex flex-1 flex-col gap-4">
            @* <div class="rounded-xl bg-gray-800 p-6">
                <h3 class="mb-2 font-semibold text-[23px] text-white">{{profile.displayName}}</h3>
                <p class="mb-2 text-gray-300">{{profile.content}}</p>
                <span class="text-xs text-gray-500">{{profile.lastModifiedText}}</span>
            </div> *@

            <div class="mb-[12px] rounded-xl bg-gray-800 p-6" v-for="(article, index) in profile.articles" :key="index">
                <div class="mb-2 flex flex-col sm:flex-row sm:items-center sm:gap-4">
                    <img :src="profile.avatarPath"
                         class="mb-2 h-16 w-16 rounded-full object-cover sm:mb-0" />
                    <h3 class="font-semibold text-[22px] text-white sm:text-[25px]">
                        {{ profile.displayName }}
                    </h3>
                </div>
                <p class="mb-2 text-gray-300">{{ article.content }}</p>
                <span class="text-xs text-gray-500">
                    {{article.timeAgoText}}
                </span>

                <img v-bind:src="'/api/ProfileApi/GetPicture/'+article.articleId+'?v='+rand"
                     class="mt-4 h-auto w-3/4 rounded-lg"
                     alt="" />
            </div>
        </div>
    </div>


    <!-- Edit Profile View -->
    <div v-if="editMode" class="fixed top-0 left-0 z-30 h-full w-full">
        <div class="relative h-full w-full">
            <div class="h-full w-full bg-white opacity-20"></div>
            <div class="absolute top-1/2 left-1/2 mx-auto flex w-full max-w-lg -translate-x-1/2 -translate-y-1/2 flex-col items-center rounded-xl bg-[#161616] p-6 shadow-2xl sm:p-8 md:max-w-xl">
                <img :src="profile.avatarPath" class="mb-4 h-[142px] w-[142px] rounded-full border-4 border-black object-cover" alt="avatar" />
                <h2 class="mb-4 w-full text-center leading-[33px] font-normal text-[33px] text-white">{{profile.displayName}}</h2>
                <div class="mb-4 w-full">
                    <textarea class="bg-opacity-70 h-[100px] w-full resize-none rounded border border-gray-400 bg-black px-4 py-2 leading-snug text-[18px] text-white focus:border-blue-500 focus:outline-none"
                           placeholder="Introduction..."
                           v-model="profile.bio"
                           type="text"
                           maxlength="125"
                    ></textarea>
                </div>

                <div class="w-full space-y-4">
                    <div class="flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                        <label class="w-full font-normal sm:w-1/3">DisplayName</label>
                        <input type="text" placeholder="DisplayName..." 
                               class="mt-2 h-[54px] w-full rounded border border-gray-400 bg-black px-4 text-[16px] text-white focus:border-blue-500 focus:outline-none sm:mt-0 sm:w-2/3"
                               v-model="profile.displayName"
                               maxlength="15"
                               />
                    </div>
                    <div class="flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                        <label class="w-full font-normal sm:w-1/3">Email</label>
                        <input 
                            type="text" 
                            placeholder="Email..." 
                            class="mt-2 h-[54px] w-full rounded border border-gray-400 bg-black px-4 text-[16px] text-white focus:border-blue-500 focus:outline-none sm:mt-0 sm:w-2/3"
                            v-model="profile.email"
                            maxlength="27"
                            
                        />
                    </div>
                    <div class="flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                        <label class="w-full font-normal sm:w-1/3">Password</label>
                        <input type="text" placeholder="Password..." 
                               class="mt-2 h-[54px] w-full rounded border border-gray-400 bg-black px-4 text-[16px] text-white focus:border-blue-500 focus:outline-none sm:mt-0 sm:w-2/3"
                               v-model="profile.password"
                               />
                    </div>
                    <div class="flex w-full flex-col text-[18px] text-white sm:flex-row">
                        <label class="mt-[5px] w-full font-normal sm:w-1/3">Website</label>
                        <div class="mt-2 w-full space-y-2 sm:mt-0 sm:w-2/3">
                            <input type="text" placeholder="Website..." 
                                   class="h-[40px] w-full rounded border border-gray-400 bg-black px-4 text-[15px] text-white focus:border-blue-500 focus:outline-none"
                                   v-model="profile.website1"
                                   maxlength="33"
                                   />
                            <input type="text" placeholder="Website..." 
                                   class="h-[40px] w-full rounded border border-gray-400 bg-black px-4 text-[15px] text-white focus:border-blue-500 focus:outline-none"
                                   v-model="profile.website2"
                                   maxlength="33"
                                   />
                            <input type="text" placeholder="Website..." 
                                   class="h-[40px] w-full rounded border border-gray-400 bg-black px-4 text-[15px] text-white focus:border-blue-500 focus:outline-none"
                                   v-model="profile.website3"
                                   maxlength="33"
                                   />
                        </div>
                    </div>
                    <div class="flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                        <label class="w-full font-normal sm:w-1/3">Wallet Address</label>
                        <div class="flex h-[54px] w-full items-center bg-[#161616] px-4 text-white sm:w-2/3">
                            <span class="fa-solid fa-crown text-[25px]"></span>
                        </div>


                    </div>
                    <!-- Toggle Switch: Private ↔ Public -->
                    <div class="flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                        <!-- 左側標籤 -->
                        <label class="w-full font-normal sm:w-1/3">Private</label>

                        <!-- 右側切換區塊 -->
                        <div class="mt-2 w-full sm:mt-0 sm:w-2/3">
                            <div class="flex items-center justify-center gap-4 sm:justify-start">
                                <!-- Private -->
                                <span class="text-[17px] text-gray-300">Private</span>

                                <!-- 切換按鈕 -->
                                <button class="relative inline-flex h-[36px] w-[64px] items-center rounded-full border border-gray-400 bg-black transition duration-300 focus:outline-none"
                                        :class="{ 'bg-green-500': isPublic }"
                                        @@click="toggleIcon">
                                    <span class="absolute left-1 h-[28px] w-[28px] transform rounded-full bg-white shadow transition duration-300"
                                          :class="{ 'translate-x-[28px]': isPublic }"></span>
                                </button>

                                <!-- Public -->
                                <span class="text-[17px] text-gray-300">Public</span>
                            </div>
                        </div>
                    </div>




                </div>

                <!--     上傳圖片       -->

                <div class="mt-4 flex w-full flex-col items-start text-[18px] text-white sm:flex-row sm:items-center">
                    <label class="w-full font-normal sm:w-1/3">Picture</label>
                    <div class="mt-2 flex h-[30px] w-full items-center sm:mt-0 sm:w-2/3">
                        <input type="file"
                               class="form-control h-full w-full rounded border border-gray-400 bg-[#161616] px-4 text-[15px] text-white"
                               v-bind:id="'editFile' + profile.avatarPath"
                               accept="image/*"
                               v-on:change="editFileChange($event.target)" />
                    </div>
                </div>

                    
                <!--     cancel and update       -->
                <div class="mt-6 flex justify-center space-x-8">
                    <button class="flex items-center rounded-xl bg-red-400 px-6 py-3 text-[16px] text-white hover:bg-red-700" @@click="cancel">
                        <i class="fa-solid fa-trash-can mr-2"></i>Cancel
                    </button>
                    <button class="flex items-center rounded-xl bg-blue-400 px-6 py-3 text-[16px] text-white hover:bg-blue-700" @@click="update">
                        <i class="fa-solid fa-floppy-disk mr-2"></i>Update
                    </button>
                </div>
                
            </div>
        </div>
    </div>
</div>


<script>
    const app = Vue.createApp({
      data() {
        return {
          rand:1,
          createTime:[],
          content:[],
          editMode: false,
          isPublic: false,
          profile: {
          isPrivate: false,
          articles:[],
          bio:[]
          }
        };
      },
      methods: {
        toggleIcon() {
          this.isPublic = !this.isPublic;
        },
        cancel(){
         // alert("cancel");
         this.editMode = false;
         // let _this=this;
         // for(var i=0;i<_this.profile.length ; i++){
         //    var prifole=_this.profile[i];
            if(this.profile.backup){
                this.profile.bio = this.profile.backup.bio;
                this.profile.displayName = this.profile.backup.displayName;
                this.profile.email = this.profile.backup.email;
                this.profile.password = this.profile.backup.password;
                this.profile.website1 = this.profile.backup.website1;
                this.profile.website2 = this.profile.backup.website2;
                this.profile.website3 = this.profile.backup.website3;

                    delete this.profile.backup;
            }
         },
         startEdit(){
            this.editMode = true;
            this.profile.backup = JSON.parse(JSON.stringify(this.profile));
         },
         update(){
            // alert(`update:${this.profile.profileId}`);
            let _this=this;
                // var form = new FormData();
                bio:this.profile.bio;
                displayName:this.profile.displayName;
                email:this.profile.email;
                password:this.profile.password;
                website1:this.profile.website1;
                website2:this.profile.website2;
                website3:this.profile.website3;
                let fileInput = document.querySelector(`#editFile${this.profile.profileId}`);
                if (fileInput && fileInput.files.length > 0){
                    form.append("picture",fileInput.files[0]);
                }
                    axios.put(`/api/ProfileApi/${this.profile.userId}`,{
                    headers:{
                        // "content-type":"multipart/form-data"
                    }
                    }).then(Response=>{
                        alert(Response.data);
                        _this.filterProfile();
                        _this.rand = new Data().getTime();
                        profile.preview = null;
                    }).catch(err=>{
                        alert("error");
                    });

         },
         editFileChange(inputTypeFile){
                 //alert(`Change:${inputTypeFile.files[0].name}`);
                 let _this=this;
                 _this.readURL(inputTypeFile,inputTypeFile.parentElement.previousSibling,$("#update"));
         },
         readURL:function(inputTypeFile,img,btn){
                        if(inputTypeFile.files[0]!=null){
                            var file=inputTypeFile.files[0];
                            var allowTypes="image.*";
                            if (file.type.match(allowTypes)){
                                btn.disabled = false;
                                var reader=new FileReader();
                                reader.onload=function(e){
                                    img.src=e.target.result;
                                    img.title=file.name;
                                };
                                reader.readAsDataURL(file);

                            }
                            else{
                                alert("不允許的檔案上傳類型！");
                                btn.disabled = true;
                                inputTypeFile.value="";
                            }
                        }
         },
        
      },
      
      mounted()
      {
        const profileId = '8615C454-4C27-4C41-9256-E609DC8465C5';
        fetch('/api/ProfileApi',{
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ id: profileId })

        })
            .then(res => res.json())
            .then(data => {
                this.profile = data;
                this.isPublic = !data.isPrivate;  //icon狀態同步
            })
            .catch(err => console.error(err));

      }

    });
    

    app.mount('#app');
</script>





@* </html> *@

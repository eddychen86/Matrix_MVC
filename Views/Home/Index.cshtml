@model List<Matrix.Models.Article>
@{
    ViewData["Title"] = "News";
}

<section class="page-wrapper">
    <div class="news-container">
        <div id="news_list" class="news-list">

            <h1 class="section-title">Hot</h1>

            <div id="hot_news" class="carousel-wrapper">
                <!-- 左箭頭 -->
                <button id="hotPrev" class="arrow arrow-l">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z" />
                    </svg>
                </button>

                <ul id="hotCarousel" class="carousel-list flex gap-4 overflow-x-auto scroll-smooth">
                    @foreach (var item in ViewBag.HotList)
                    {
                        <li class="carousel-item-custom h-[250px] w-[190px] flex-none">
                            <div class="card">
                                <figure>
                                    <img src="@(item.image?.FilePath ?? "/img/placeholder.png")" alt="" />
                                </figure>
                                <div class="card-body">
                                    <div>
                                        <img src="@(item.Author?.AvatarPath ?? "/img/avatar_default.png")" alt="">
                                        <h2 class="card-title">@item.Author?.DisplayName</h2>
                                    </div>
                                    <div class="card-actions justify-end">
                                        <p>@item.Article.Content</p>
                                    </div>
                                </div>
                            </div>
                        </li>
                    }
                </ul>

                <!-- 右箭頭 -->
                <button id="hotNext" class="arrow arrow-r">
                    <svg viewBox="0 0 24 24" class="icon">
                        <path d="M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z" />
                    </svg>
                </button>
            </div>

            <h3 class="section-title">News</h3>

            @foreach (var post in ViewBag.HotList)
            {
                <div class="post-card">
                    <img src="@(post.Author?.AvatarPath ?? "/img/avatar_default.png")" class="post-avatar" />

                    <div class="post-author">
                        <span class="author-name">@(post.Author?.DisplayName ?? "Unknown")</span>
                        <time class="post-time">@post.Article.CreateTime.ToString("yyyy/MM/dd HH:mm")</time>
                    </div>

                    <p class="post-content">@post.Article.Content</p>

                    <div class="carousel-item">
                        @if (post.image != null)
                        {
                            <img src="@post.image.FilePath" class="post-image" />
                        }
                    </div>
                </div>
            }

        </div>
    </div>

    <aside id="friends_list" class="friend-panel">
        <div class="friend-search-bar">
            <button class="friend-icon-btn">
                <svg class="friend-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0 0h24v24H0z" fill="none"></path>
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path>
                </svg>
            </button>
            <input type="text" placeholder="Search friends" class="friend-search-input" />
        </div>

        @{
            var demoFriends = new[]
            {
                new { Name = "Alice", Avatar = "https://cataas.com/cat" },
                new { Name = "Bob",   Avatar = "https://cataas.com/cat" },
                new { Name = "Carol", Avatar = "https://cataas.com/cat" },
                new { Name = "Dave",  Avatar = "https://cataas.com/cat" }
            };
        }

        @foreach (var friend in demoFriends)
        {
            <div class="friend-item">
                <img src="@friend.Avatar" class="friend-avatar" />
                <span class="friend-name">@friend.Name</span>
            </div>
        }

    </aside>
</section>

@section Scripts {
    <script>
        const carousel = document.getElementById("hotCarousel");
        const btnPrev = document.getElementById("hotPrev");
        const btnNext = document.getElementById("hotNext");

        if (carousel && btnPrev && btnNext) {
          const scrollAmount = 200;

          btnPrev.addEventListener("click", () => {
            if (carousel.scrollLeft <= 0) {
              carousel.scrollTo({
                left: carousel.scrollWidth,
                behavior: 'smooth'
              });
            } 
            else {
              carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            }
          });

          btnNext.addEventListener("click", () => {
            const maxScrollLeft = carousel.scrollWidth - carousel.clientWidth;
            if (carousel.scrollLeft >= maxScrollLeft - 10) {
              carousel.scrollTo({ left: 0, behavior: 'smooth' });
            } 
            else {
              carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
          });
        }
    </script>
}


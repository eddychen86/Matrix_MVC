@* Model no longer used; hot list loads via API *@
@using Matrix.Services
@inject ICustomLocalizer Localizer

<!-- 文章 -->
<div class="col-span-7 flex flex-col gap-8 2xl:col-span-4 2xl:col-start-2">

    @* 熱門文章輪播（僅登入可見） *@
    <section class="home-hots_list">
        <h1 class="title">Hot</h1>
        <div class="hots_list_carousel">
            <button v-on:click="hotPrev">
                <i data-lucide="chevron-left" class="size-6"></i>
            </button>
            <button v-on:click="hotNext">
                <i data-lucide="chevron-right" class="size-6"></i>
            </button>

            <ul ref="hotCarouselRef" v-if="hotlist && hotlist.length" class="h-64 flex gap-x-4 overflow-x-auto">
                <li v-for="item in hotlist" :key="item.articleId" class="min-w-1/4 h-full bg-accent rounded-[30px]">
                    <div class="card image-full shadow-sm size-full relative">
                        <figure>
                            <img v-if="item.image && item.image.filePath && !hasError(item, 'image')" 
                                 :src="item.image.filePath" 
                                 @@error="handleImageError(item, 'image')" />
                            <div v-else class="no-img bg-accent size-full flex items-center justify-center">
                                <i data-lucide="image" class="size-24 text-stone-600"></i>
                            </div>
                        </figure>

                        <div class="absolute top-0 left-0 card-actions size-full flex flex-col justify-between gap-4 p-6 !select-none">
                            <p class="SubTitle text-white">
                                {{ item.content.length > 50 ? `${item.content.slice(0, 50)}...` : item.content }}
                            </p>

                            <a :href="`/Profile/${item.authorName.replace(/\s+/g, '')}`" class="flex justify-between gap-4">
                                <div class="size-10 rounded-full overflow-hidden border-2 border-white flex items-center justify-center bg-secondary">
                                    <img v-if="item.authorAvatar && item.authorAvatar !== '' && !hasError(item, 'avatar')" 
                                         :src="item.authorAvatar" 
                                         :alt="item.authorName" 
                                         @@error="handleImageError(item, 'avatar')"
                                         class="size-full" />
                                    <div v-else class="no-img size-full flex items-center justify-center">
                                        <span>{{ (item.authorName || '').slice(0, 1).toUpperCase() }}</span>
                                    </div>
                                </div>
                                <h2 class="card-title text-sm text-white">{{ item.authorName }}</h2>
                            </a>
                        </div>
                    </div>
                </li>
            </ul>

            <div class="no-data" v-else>
                <i data-lucide="file-text" class="size-12"></i>
                <p class="subTitle">No data</p>
            </div>
        </div>
    </section>

    
    <!-- 文章列表 -->
    <section class="home-posts_list">

        <div class="post_editor_app">
            <h3 class="title">News</h3>
            <!--發文編輯-->
            @if (ViewBag.IsAuthenticated == true)
            {
                <button v-on:click="openModal">
                    <i data-lucide="plus" class="size-6 text-black"></i>
                    <span class="subTitle">Post</span>
                </button>
            }
        </div>

        <ul class="post-content" id="homePostsList">
            @await Component.InvokeAsync("PostList")
        </ul>
    </section>
</div>

<!-- 好友列表 -->
<!--
    <aside class="friends-list">
        await Component.InvokeAsync("FriendsList")
    </aside>
-->
@if (ViewBag.IsAuthenticated) {
    @* Create Post Popup Component *@
    @await Component.InvokeAsync("CreatePostPopup")

    <!-- 留言視窗 -->
    @await Component.InvokeAsync("ReplyPopup")
}

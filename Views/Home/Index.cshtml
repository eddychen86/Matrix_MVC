@model List<Matrix.ViewModels.ArticleViewModel>
@using Matrix.Services
@inject ICustomLocalizer Localizer
<section class="flex min-h-screen">
    <div id="news_list" class="w-full">
        <!-- 熱門文章輪播 -->
        <h1 class="title">Hot</h1>
        <div id="hot_news" class="relative mx-auto mb-8 flex w-max max-w-3xl flex-col items-center">


            <button id="hotPrev" class="absolute top-[50%] -left-12 z-50 flex h-[50px] w-[50px] -translate-y-1/2 transform items-center justify-center rounded-full bg-white text-black shadow transition hover:bg-gray-200 focus:outline-none">
                <svg viewBox="0 0 24 24" class="icon">
                    <path d="M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z" />
                </svg>
            </button>

            <button id="hotNext" class="absolute top-[50%] -right-12 z-50 flex h-[50px] w-[50px] -translate-y-1/2 transform items-center justify-center rounded-full bg-white text-black shadow transition hover:bg-gray-200 focus:outline-none">
                <svg viewBox="0 0 24 24" class="icon">
                    <path d="M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z" />
                </svg>
            </button>

            <ul class="carousel carousel-center w-[600px] gap-4 text-center">
                @if (Model != null)
                {
                    foreach (var item in Model.Take(5))
                    {
                        <li class="carousel-item h-[250px] w-[190px] overflow-hidden rounded-[30px]">
                            <div class="card bg-base-100 image-full shadow-sm">
                                <figure>
                                    @if (item.Image != null && item.Image.FilePath != null)
                                    {
                                        <img src="@item.Image.FilePath" alt="@item.Article?.Content" class="h-full w-full object-cover" />
                                    }
                                    else
                                    {
                                        <div class="bg-accent flex h-full w-full items-center justify-center">
                                            <i data-lucide="image" class="h-12 w-12 text-gray-400"></i>
                                        </div>
                                    }
                                </figure>
                                <div class="card-body">
                                    <div class="mb-2 flex items-center gap-2">
                                        @if (item.Author != null && !string.IsNullOrEmpty(item.Author.AvatarPath))
                                        {
                                            <img src="@item.Author.AvatarPath" alt="@item.Author.DisplayName" class="h-8 w-8 rounded-full object-cover" />
                                        }
                                        else
                                        {
                                            <div class="bg-orange flex h-8 w-8 items-center justify-center rounded-full">
                                                <span class="text-sm font-bold text-white">@item.Author?.DisplayName?.Substring(0, 1).ToUpper()</span>
                                            </div>
                                        }
                                        <h2 class="card-title text-sm">@((item.Author?.DisplayName) ?? item.Author?.UserId.ToString())</h2>
                                    </div>
                                    <div class="card-actions justify-end">
                                        <p class="line-clamp-3 text-xs">@item.Article?.Content</p>
                                    </div>
                                </div>
                            </div>
                        </li>
                    }
                }
            </ul>
        </div>

        <!-- 文章列表 -->
        <div id="posts_list">
            
            <div id="postEditorApp">
                <h3 class="title">News</h3>
                <!--發文編輯-->
                <button id="openPostBtn">
                    <i data-lucide="plus" class="size-6 text-black"></i>
                    <span class="subTitle">Post</span>
                </button>
            </div>

            <ul class="post-content">

                @if (Model != null)
                {
                    for (int i = 0; i < Model.Count; i++)
                    {
                        var item = Model[i];
                        <li>
                            <article class="bg-accent" data-article-index="@i">
                                @* 文章標題區 *@
                                <div class="post-content_header">
                                    <div class="author-info flex gap-4 items-center">
                                        <div class="author-avatar">
                                            @if (item.Author != null && !string.IsNullOrEmpty(item.Author.AvatarPath)){
                                                <img src="@item.Author.AvatarPath" alt="@item.Author.DisplayName" />
                                            } else {
                                                <span class="bg-secondary">@item.Author?.DisplayName?.Substring(0, 1).ToUpper()</span>
                                            }
                                        </div>
                                        <div>
                                            <h3 class="text-white font-medium">@(item.Author?.DisplayName ?? Localizer["GuestAccount"])</h3>
                                            <p class="text-gray-400 text-sm">@item.Article?.CreateTime.ToString("yyyy-MM-dd HH:mm")</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 text-gray-400 text-sm">
                                        <i data-lucide="heart" class="w-4 h-4"></i>
                                        <span>@item.Article?.PraiseCount</span>
                                        <i data-lucide="bookmark" class="w-4 h-4 ml-2"></i>
                                        <span>@item.Article?.CollectCount</span>
                                    </div>
                                </div>

                                @* 文章內容 *@
                                <div class="text-gray-300 mb-4 leading-relaxed">
                                    @Html.Raw(item.Article?.Content != null && item.Article.Content.Length > 300 
                                        ? item.Article.Content.Substring(0, 300) + "..." 
                                        : item.Article?.Content)
                                </div>

                                @* 文章圖片 *@
                                @if (item.Image != null && item.Image.FilePath != null)
                                {
                                    <div class="rounded-[30px] overflow-hidden flex items-center justify-center">
                                        <img src="@item.Image.FilePath" alt="" class="object-cover hover:scale-105 transition-transform duration-300" />
                                    </div>
                                }

                                @* 文章附件 *@
                                @if (item.Attachments != null && item.Attachments.Any())
                                {
                                    <div class="grid grid-cols-2 gap-4">
                                        @foreach (var attachment in item.Attachments)
                                        {
                                            <a href="@attachment.FilePath" class="block p-3 bg-gray-800 rounded-[20px] hover:bg-gray-700 transition-colors duration-300">
                                                <div class="flex items-center gap-3">
                                                    <div class="flex-shrink-0">
                                                        <i data-lucide="file" class="w-6 h-6 text-gray-400"></i>
                                                    </div>
                                                    <div class="flex-1 min-w-0">
                                                        <p class="text-sm text-white truncate">@attachment.FileName</p>
                                                        <p class="text-xs text-gray-400">附件</p>
                                                    </div>
                                                </div>
                                            </a>
                                        } 
                                    </div>
                                }

                                @* 文章操作列 *@
                                <div class="post-content_state">
                                    @if (ViewBag.IsAuthenticated == true)
                                    {
                                        <button>
                                            <i data-lucide="heart" class="size-4"></i>
                                            <span>@Localizer["Praise"]</span>
                                        </button>
                                        <button>
                                            <i data-lucide="message-circle" class="size-4"></i>
                                            <span>@Localizer["Comment"]</span>
                                        </button>
                                        <button>
                                            <i data-lucide="share" class="size-4"></i>
                                            <span>@Localizer["Share"]</span>
                                        </button>
                                        <button>
                                            <i data-lucide="bookmark" class="size-4"></i>
                                            <span>@Localizer["Collect"]</span>
                                        </button>
                                    }
                                    else
                                    {
                                        <span class="flex items-center gap-2 text-gray-500 text-sm">
                                            <i data-lucide="lock" class="w-4 h-4"></i>
                                            <span data-i18n="GuestBrowseMsg">@Localizer["GuestBrowseMsg"]</span>
                                        </span>
                                    }
                                </div>
                            </article>
                        </li>
                    }
                }
                else
                {
                    <div class="text-center py-12">
                        <i data-lucide="inbox" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                        <p class="text-gray-400 text-lg" data-i18n="NoArticlesMsg">@Localizer["NoArticlesMsg"]</p>
                    </div>
                }
            </ul>

            @* 訪客限制提示（僅在訪客狀態下顯示） *@
            @* @if (ViewBag.IsGuest == true && ViewBag.IsAuthenticated == false)
            {
                <div class="border-accent/20 border-t py-8 text-center">
                    <div class="bg-secondary border-accent/20 rounded-xl border p-6">
                        <h3 class="mb-2 text-lg font-medium text-white" data-i18n="AllContentViewedTitle">@Localizer["AllContentViewedTitle"]</h3>
                        <p class="mb-4 text-gray-400" data-i18n="LoginForMoreContentMsg">@Localizer["LoginForMoreContentMsg"]</p>
                        <a href="/login" class="bg-orange inline-flex items-center gap-2 rounded-full px-6 py-2 text-white transition-colors hover:bg-orange-600">
                            <i data-lucide="log-in" class="h-4 w-4"></i>
                            <span data-i18n="LoginNowBtn">@Localizer["LoginNowBtn"]</span>
                        </a>
                    </div>
                </div>
            } *@
        </div>
    </div>
</section>


@* Create Post Popup Component *@
@await Component.InvokeAsync("CreatePostPopup")





@section Scripts {
    <script>
        window.matrixAuthData = {
            isAuthenticated: @Html.Raw(ViewBag.IsAuthenticated?.ToString().ToLower() ?? "false"),
            isGuest: @Html.Raw(ViewBag.IsGuest?.ToString().ToLower() ?? "false"),
            articleLimit: @(ViewBag.ArticleLimit ?? 10),
            totalArticles: @(ViewBag.TotalPublicArticles ?? 0),
            user: {
                userId: '@ViewBag.CurrentUser.UserId',
                displayName: '@ViewBag.CurrentUser.DisplayName',
                avatar: '@ViewBag.CurrentUser.Avatar'
            }
        };
    </script>
    
    @* Load page-specific JavaScript files *@
    <script src="~/js/pages/home/index.js"></script>
    <script src="~/js/pages/home/create-post.js"></script>
}